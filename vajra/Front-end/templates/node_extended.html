{%load static%}
{%load bytetogb%}
{%load time%}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Node Info</title>
    <link rel="stylesheet" href="{%static 'assets/css/Poppins.css'%}">
    <link rel="stylesheet" href="{%static  'assets/css/animate.min.css'%}">
    <link rel="stylesheet" href="{% static 'assets/bootstrap/css/bootstrap.min.css'%}">
    <link rel="stylesheet" href="{% static 'assets/fonts/fontawesome-all.min.css'%}">
    <link rel="stylesheet" href="{% static 'assets/fonts/font-awesome.min.css'%}">
    <link rel="stylesheet" href="{% static 'assets/fonts/fontawesome5-overrides.min.css'%}">
    <link rel="stylesheet" href="{% static 'assets/css/Features-Clean.css'%}">
    <link rel="stylesheet" href="{% static 'assets/css/Navigation-Clean.css'%}">
    <link rel="stylesheet" href="{% static 'assets/css/Social-Icons.css'%}">
    {% if not_found %}
    <link rel="stylesheet" href="{%static 'assets/css/page404.css'%}">
    {%endif%}
    <!-- <link rel="stylesheet" href="{% static 'assets/css/styles.css'%}"> -->
    <link rel="stylesheet" href="{% static 'assets/css/style.css'%}">
</head>

<body style="background: #21242b;font-family: Poppins, sans-serif;">
    <div class="alert alert-success" id="conAlert" role="alert" style="display: none;">
        <div class="row">
            <div class="col"><span id="mess"></span></div>
            <div class="col" style="display: flex;justify-content: flex-end;">
                <!-- <button class="close" onclick="closeAlert('conAlert')" style="border: 0;background-color: transparent;font-size: larger;">&times;</button> -->
                <button type="button" class="close" onclick="closeAlert('conAlert')">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        </div>
    </div>
    <div class="alert alert-success alert-dismissible" role="alert" id="reinAlert" style="display: none;">
        <strong>{{hostINFO.host_identifier}}</strong> Re-enrollment allowed
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-1 " id="sidebar">
                <div class="container">
                    <div class="text-center"><a href="/home">
                            <div
                                style="height: 50px;padding: 0;border-width: 0;border-left-style: solid;border-left-color: #ef422a;">
                                <div
                                    style="height: 57px;width: 70px;margin-left: 26px;padding: 17px;background: rgba(17,18,22,0);text-align: center;border-radius: 0px;border-top-left-radius: 15px;border-top-right-radius: 15px;">
                                    <i class="fas fa-arrow-left" style="font-size: 20px;color: #ef422a;"></i>
                                </div>
                            </div>
                        </a></div>
                </div>
            </div>
            {%if hostINFO%}
            <div class="col-lg-7 web-body">
                <div class="container" style="margin-top: 20px;">
                    <div class="card" style="margin-top: 2%;background: rgb(49,52,59);border-radius: 25px;box-shadow: -30px 26px 36px -10px rgba(0,0,0,1);
                -webkit-box-shadow: -30px 26px 36px -10px rgba(0,0,0,1);
                -moz-box-shadow: -30px 26px 36px -10px rgba(0,0,0,1);margin-bottom: 2%;padding: 2%;">
                        <div class="intro"
                            style="color: #ffffff; display: flex; justify-content: space-around;align-items: center;">
                            <h2 class="text-center" style="color: rgb(255,255,255)">
                                <button class="btn btn-outline-info mr-3 btn-lg" type="button" data-toggle="collapse"
                                    data-target="#addhocSearch" aria-expanded="false" aria-controls="addhocSearch">
                                    Query&nbsp;&nbsp;<i class="fa fa-search" aria-hidden="true"></i>
                                </button>
                                {{hostINFO.hostname}}
                                <input type="hidden" name="hostname" value="{{hostINFO.hostname}}">
                            </h2>
                            <p class="text-center">{% if hostINFO.last_seen.3 == "n" %}
                                <img src="{% static 'assets/img/green_dot.jpg'%}"
                                    style="height: 12px;border-radius: 50px;width: 12px;margin-right: 15px;">
                                {% elif hostINFO.last_seen.3 == "f" %}
                                <img src="{% static 'assets/img/red_dot.jpg'%}"
                                    style="height: 12px;border-radius: 50px;width: 12px;margin-right: 15px;">
                                {%endif%}{{hostINFO.host_identifier}}<br>{%if sec%}<span>Last
                                    seen&nbsp;:&nbsp;
                                    {{ sec | sectohr }}</span>{%endif%}
                            </p>
                        </div>
                    </div>
                    <div class="collapse" id="addhocSearch">
                        <div class="card" style="margin-top: 2%;background: rgb(49,52,59);border-radius: 25px;box-shadow: -30px 26px 36px -10px rgba(0,0,0,1);
                -webkit-box-shadow: -30px 26px 36px -10px rgba(0,0,0,1);
                -moz-box-shadow: -30px 26px 36px -10px rgba(0,0,0,1);margin-bottom: 2%;">
                            <form autocomplete="off" id="queryForm">
                                {% csrf_token %}
                                <div class="card-body" style="height: 90px;display: flex;padding-left: 10%;">
                                    <div
                                        style="width: 60%;height: 100%;background: white;border-radius: 25px;overflow: hidden;">
                                        <input type="text" name="query" id="query4hawk" placeholder="Query" oninput="focusIt(this.id)"
                                            style="padding-left: 10%;height: 100%;border: none;width: 90%;font-size: 20px;font-weight: 700;">
                                    </div>
                                    <input type="checkbox" name="hosts" value="{{hostINFO.host_identifier}}"
                                        style="width: 30px;height: 30px;display: none;" checked>
                                    <span style="height: 100%;display: flex;align-items: center;margin-left: -5%;background-color: transparent;" name="search">
                                        <i class="fas fa-search"></i>
                                    </span>
                                    <span style="height: 100%;display: none;align-items: center;margin-left: -5%;background-color: transparent;" name="cross">
                                        <i class="fas fa-times" style="cursor: pointer;" onclick="erase()"></i>
                                    </span>
                                    <button class="btn btn-primary" type="button" onclick="Submit()" id="sub24"
                                        style="margin-left: 10%;width: 20%;border: none;font-weight: 700;border-radius: 25px;background: #a1c9ad;outline: none;">Submit</button>
                                </div>
                            </form>
                            <div class="row" style="width: 40%;margin-bottom: 1%;">
                                <div class="col" style="display: flex;justify-content: center;">
                                    <div class="dropdown">
                                        <button class="btn-lg btn-secondary dropdown-toggle" type="button" id="querySelector" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                                    Know Query
                                                </button>
                                        <div class="dropdown-menu" aria-labelledby="querySelector">
                                            <a class="dropdown-item" href="#" onclick="fillQuery(0)">Select all users</a>
                                            <a class="dropdown-item" href="#" onclick="fillQuery(1)">top 5 memory consuming process</a>
                                            <a class="dropdown-item" href='#' onclick="fillQuery(2)">top 5 CPU consuming process</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="querydata">
                        <div class="card" style="margin-top: 2%;background: rgb(49,52,59);border-radius: 25px;box-shadow: -30px 26px 36px -10px rgba(0,0,0,1);
                        -webkit-box-shadow: -30px 26px 36px -10px rgba(0,0,0,1);
                        -moz-box-shadow: -30px 26px 36px -10px rgba(0,0,0,1);margin-bottom: 2%;">
                        <div class="row" style="padding: 0;margin: 0;">
                            <div class="col" style="display: flex;justify-content: flex-start;padding: 2%;font-size: larger;color: cornsilk;"><p id="error"></p></div>
                            <div class="col" style="display: flex;justify-content: flex-end;padding: 2%;"><button onclick="closeIt()" style="border: 0px;background-color: transparent;"><i class="fas fa-times" style="font-size: larger;color: #DC3545;"></i></button></div>
                        </div>
                        <div class="row" style="padding: 0;margin: 0;">
                            <div class="col" style="padding-left: 2%;margin-right: 2%;">
                                <div id="mySpace" style="height: 400px;display: none;margin-bottom: 2%;" class="ag-theme-alpine-dark"></div>
                            </div>
                        </div>
                    </div>
                    </div>
                    <div class="row">
                        <div class="col-xl-7">
                            <section class="features-clean" style="background: #31343b;border-radius: 25px;box-shadow: -30px 26px 36px 1px rgba(0,0,0,1);
                                -webkit-box-shadow: -30px 26px 36px 1px rgba(0,0,0,1);
                                    -moz-box-shadow: -30px 26px 36px 1px rgba(0,0,0,1);overflow: hidden;">
                                <div
                                    style="background-color: #1b1e22;display: flex;justify-content: center;align-items: center;padding: 2%;">
                                    <h3 style="color: #ffffff;">Hardware info</h3>
                                </div>
                                <p class="description">CPU Logical
                                    Core&nbsp;&nbsp;&nbsp:&nbsp&nbsp;&nbsp;{{hostINFO.hardware_cpu_logical_core}}<br><br>
                                    Hardware Model&nbsp;&nbsp;&nbsp:&nbsp&nbsp;&nbsp;{{hostINFO.hardware_model}}<br><br>
                                    Hardware
                                    Vendor&nbsp;&nbsp;&nbsp:&nbsp&nbsp;&nbsp;{{hostINFO.hardware_vendor}}<br><br>
                                    Hardware Physical
                                    Memory&nbsp;&nbsp;&nbsp:&nbsp&nbsp;&nbsp;{{hostINFO.hardware_physical_memory|byte_gb }}B<br>
                                </p>
                            </section>
                            <section class="features-clean"
                                style="background: #31343b;border-radius: 25px;box-shadow: -30px 26px 36px 1px rgba(0,0,0,1);
                                -webkit-box-shadow: -30px 26px 36px 1px rgba(0,0,0,1);
                                    -moz-box-shadow: -30px 26px 36px 1px rgba(0,0,0,1);overflow: hidden;margin-top: 5%;">
                                <div
                                    style="background-color: #1b1e22;display: flex;justify-content: center;align-items: center;padding: 2%;">
                                    <h3 style="color: #ffffff;">Severity</h3>
                                </div>
                                <div class="row">
                                    <div class="col"
                                        style="display: flex;flex-direction: column;text-align: start;justify-content: center;">
                                        <!-- <p>None : 12</p>
                                            <p>Information : 46</p>
                                            <p>Low : 767</p>
                                            <p>Medium : 42344</p>
                                            <p>High : 4323</p> -->
                                        <table style="color: #71777A" class="Info-Table">
                                            <tr>
                                                <th>None</th>
                                                <td id="non"></td>
                                            </tr>
                                            <tr>
                                                <th>Information</th>
                                                <td id="information"></td>
                                            </tr>
                                            <tr>
                                                <th>Low</th>
                                                <td id="low"></td>
                                            </tr>
                                            <tr>
                                                <th>Medium</th>
                                                <td id="medium"></td>
                                            </tr>
                                            <tr>
                                                <th>High</th>
                                                <td id="high"></td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col"><canvas id="sivChart"></canvas></div>
                                </div>
                            </section>
                        </div>
                        <div class="col-xl-5">
                            <section class="features-clean" style="background: #31343b;border-radius: 25px;box-shadow: -30px 26px 36px 1px rgba(0,0,0,1);
                        -webkit-box-shadow: -30px 26px 36px 1px rgba(0,0,0,1);
                        -moz-box-shadow: -30px 26px 36px 1px rgba(0,0,0,1);overflow: hidden;margin-bottom: 10%;">
                                <div
                                    style="background-color: #1b1e22;display: flex;justify-content: center;align-items: center;padding: 2%;">
                                    <h3 style="color: #ffffff;">Software info</h3>
                                </div>
                                <p class="description">
                                    Enrolled-on&nbsp;&nbsp;&nbsp:&nbsp&nbsp;&nbsp;{{hostINFO.enrolled_on | print_timestamp}} <br>
                                    Os - Info&nbsp;&nbsp;&nbsp:&nbsp&nbsp;&nbsp;{{hostINFO.os_name}}&nbsp;&nbsp;{{hostINFO.os_arch}}&nbsp;{{hostINFO.os_major}}.{{hostINFO.os_minor}}
                                </p>
                            </section>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3">
                <div class="container con_right" style="margin-top: 10px;">
                    <div class="chart">
                        <canvas id="my-cpu-Chart"></canvas>
                    </div>
                    <!-- <div class="chart">
                        <canvas id="my-mem-Chart"></canvas>
                    </div> -->
                    <div class="enroll">
                        <form action="/reIN/" method="GET">
                            <section style="text-align: center;padding: 25px;">
                                <div class="d-lg-flex justify-content-lg-start">
                                    <input type="checkbox" name="reIN" id="rein_box" style="transform: scale(2);"
                                        {{rein}}>
                                    <label style="margin-left: 25px;font-size: 25px;">Re-enroll<br></label>
                                </div>
                                <div class="d-lg-flex justify-content-lg-start"
                                    style="text-align: center;margin-left: 30%;">
                                    <input type="checkbox" id="host_id" name="host_id"
                                        value="{{hostINFO.host_identifier}}"
                                        style="width: 30px;height: 30px;display: none;" checked>
                                </div>
                            </section><button class="btn btn-lg" data-bss-hover-animate="rubberBand" type="submit"
                                onclick="enroll()"
                                style="color: #ffffff;width: 169px;height: 57px;margin-left: 0px;border-radius: 25px;outline: none;background: rgba(255,255,255,0);border-color: gold;margin-top: 10px;">Submit</button>
                        </form>
                    </div>
                    <div class="enroll">
                        <form action="/nodecon/" method="GET">
                            <input type="text" name="config_id" id="config_id" value="{{hostINFO.config_id}}" style="display: none;">
                            <div class="row">
                                <div class="col" style="margin-top: 5%;">
                                    <!-- <span style="font-size: large;font-weight: 700;">Node Config</span> -->
                                    <input type="hidden" id="csrfmiddlewaretoken"
                                        value="IXiGFMTuR0FS5rnYSc0dLVzR6wMOtgPFbs5A9IE3eIud9nk9iXgiF1oaPL8oXIpd">
                                    <!-- <textarea name="config_id" id="config_id" cols="20" rows="2"
                                        style="background-color: transparent;font-size: large;padding: 5%;border: 0px;color: #ffffff;">{{hostINFO.config_id}}</textarea> -->
                                    <!-- <input type="checkbox" name="host_id" value="{{hostINFO.host_identifier}}"
                                        style="width: 30px;height: 30px;display: none;" checked> -->
                                    <div class="dropdown">
                                        <button  style="width: 60%;height: 6vh;margin-bottom: 5%;" class="btn btn-secondary dropdown-toggle" type="button" id="configDrop"
                                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            Select config
                                        </button>
                                        <div class="dropdown-menu" aria-labelledby="configDrop">
                                            {%for i in config%}
                                            <div class="dropdown-item">
                                                <input type="checkbox" onchange="mapValue(this.id)" value="{{i.id}}"
                                                    id="config_{{i.id}}" {%if i.id in hostINFO.config_id|to_list%}checked{%endif%}>
                                                <span>{{i.query_name}}</span>
                                            </div>
                                            {%endfor%}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <button class="btn btn-lg" data-bss-hover-animate="rubberBand" type="button"
                                        onclick="update_config()"
                                        style="color: #ffffff;width: 200px;height: 57px;margin-left: 0px;border-radius: 25px;outline: none;background: rgba(255,255,255,0);border-color: gold;margin-top: 10px;">Update
                                        Config</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="enroll" style="margin-top: 10%;">
                        <div style="margin: 2%;padding: 2%;">
                            <ul style="color: #DC3545;text-align: start;">
                                <li>This action cannot be undone.</li>
                                <li>This will permanently delete the Node</li>
                            </ul>
                        </div>
                        <form action="/delete/" method="GET" style="margin: 2%;padding: 2%;">
                            <!-- Button trigger modal -->
                            <button type="button" class="btn btn-lg" data-toggle="modal" data-target="#exampleModal"
                                style="color: #ffffff;width: 169px;height: 57px;margin-left: 0px;border-radius: 25px;outline: none;background: rgba(255,255,255,0);border-color: #DC3545;margin-top: 10px;">
                                Delete
                            </button>
                            <div class="d-lg-flex justify-content-lg-start"
                                style="text-align: center;margin-left: 30%;">
                                <input type="checkbox" name="host_id" value="{{hostINFO.host_identifier}}"
                                    style="width: 30px;height: 30px;display: none;" checked>
                            </div>
                            <!-- Modal -->
                            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
                                aria-labelledby="exampleModalLabel" aria-hidden="true" style="color: #DC3545;">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h6 class="modal-title" id="exampleModalLabel">Delete
                                                <br>{{hostINFO.host_identifier}} permanently
                                            </h6>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                data-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-danger"
                                                onclick="setDeleteMsg()">Delete</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            {%else%}
            <div class="container" style="height: 100vh;display: flex;justify-content: center;align-items: center;">
                <div id="truck">
                    <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        x="0px" y="0px" viewBox="0 0 200 82.7" style="enable-background:new 0 0 200 82.7;"
                        xml:space="preserve">
                        <g id="Calque_1">
                            <text id="XMLID_3_" transform="matrix(1.2187 0 0 1 13 75.6393)" class="st0 st1">4</text>
                            <text id="XMLID_4_" transform="matrix(1.2187 0 0 1 133.0003 73.6393)"
                                class="st0 st1">4</text>
                        </g>
                        <g id="Calque_2">
                            <g>
                                <path id="XMLID_11_" d="M81.8,29.2c4.1-5.7,10.7-9.4,18.3-9.4c6.3,0,12.1,2.7,16.1,6.9c0.6-0.4,1.1-0.7,1.7-1.1
                        c-4.4-4.8-10.8-7.9-17.8-7.9c-8.3,0-15.6,4.2-20,10.6C80.7,28.5,81.3,28.8,81.8,29.2z" />
                                <path id="XMLID_2_" d="M118.1,53.7c-4,5.7-10.7,9.5-18.2,9.5c-6.3,0-12.1-2.6-16.2-6.8c-0.6,0.4-1.1,0.7-1.7,1.1
                        c4.4,4.8,10.8,7.8,17.9,7.8c8.3,0,15.6-4.3,19.9-10.7C119.2,54.5,118.6,54.1,118.1,53.7z" />
                                <animateTransform attributeName="transform" type="rotate" from="360 100 41.3"
                                    to="0 100 41.3" dur="10s" repeatCount="indefinite" />
                            </g>
                            <g id="XMLID_6_">
                                <g id="XMLID_18_">
                                    <circle class="circle" cx="100" cy="41" r="1"></circle>
                                </g>
                            </g>
                            <defs>
                                <filter id="blurFilter4" x="-20" y="-20" width="200" height="200">
                                    <feGaussianBlur in="SourceGraphic" stdDeviation="2" />
                                </filter>
                            </defs>
                            <path id="XMLID_5_" class="st2" d="M103.8,16.7c0.1,0.3,0.1,0.6,0.1,0.9c11.6,1.9,20.4,11.9,20.4,24.1c0,13.5-10.9,24.4-24.4,24.4
                  S75.6,55.1,75.6,41.7c0-3.2,0.6-6.3,1.7-9.1c-0.3-0.2-0.5-0.3-0.7-0.5c-1.2,3-1.9,6.2-1.9,9.6c0,14,11.3,25.3,25.3,25.3
                  s25.3-11.3,25.3-25.3C125.3,29,115.9,18.5,103.8,16.7z" />
                        </g>
                    </svg>
                    <div class="message">
                        Node Information not available
                    </div>
                </div>
            </div>
            {%endif%}
        </div>
    </div>
    <script src="{%static 'assets/js/chart.js'%}"></script>
    <script src="{%static 'assets/js/jquery.min.js'%}"></script>
    <script src="{%static 'assets/bootstrap/js/bootstrap.min.js'%}"></script>
    <script src="{%static 'assets/js/bs-init.js'%}"></script>
    <script src="{%static 'assets/js/graph.js'%}"></script>
    <script src="{%static 'assets/js/extended.js'%}"></script>
    <script src="{%static 'assets/js/ag-grid-community.min.js'%}"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        function setDeleteMsg() {
            localStorage.setItem("delete", 1);
        }
    </script>
    <script>
        function enroll() {
            localStorage.setItem("clicked", 1);
        }
        if (localStorage.getItem("clicked") == 1) {
            if (document.getElementById('rein_box').checked) {
                $('#reinAlert').css("display", "inherit");

                $('#reinAlert').alert();
            }
            else {
                $("#reinAlert").alert('close');
            }
            localStorage.setItem("clicked", 0);
        }
    </script>
    <script>
        $("#sub24").hover(function () {
            $(this).css("background-color", "#F27280");
        }, function () {
            $(this).css("background-color", "#D5E8DB");
        });
    </script>
    <script>
        var list = String(document.getElementById('config_id').value).split(',');
        function mapValue(conID) {
            if (document.getElementById(conID).checked == true) {
                list.push(document.getElementById(conID).value);
            }
            else {
                removeItemOnce(list,document.getElementById(conID).value);
            }
        }
        function removeItemOnce(arr, value) {
            var index = arr.indexOf(value);
            if (index > -1) {
                arr.splice(index, 1);
            }
            return arr;
        }
        function update_config() {
            // list.sort(function(a, b){return a - b});
            let xhr = new XMLHttpRequest();
            document.getElementById('config_id').value=String(list);
            let host = document.getElementById("host_id").value;
            let config = document.getElementById("config_id").value;
            // const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            xhr.open('GET', "/nodecon/?host=" + host + "&config=" + config, false);
            // xhr.setRequestHeader('X-CSRFToken', csrftoken);
            xhr.send();
            var response = xhr.responseText;
            data = JSON.parse(response)
            $("#mess").html(data["message"]["message"]);
            $("#conAlert").css("display", "inherit");
            // setInterval(() => {
            //     $("#conAlert").css("display", "none");
            // }, 3000);
        }
        function closeAlert(id) {
            document.querySelector("#"+id).style.display="none";
        }
    </script>
</body>

</html>