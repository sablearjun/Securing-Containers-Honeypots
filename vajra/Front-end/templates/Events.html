{% extends "boiler.html" %}
{%load static%}
{% load json %}
{% load time %}
{%load capthename%}

{%block title%}Events{%endblock title%}

{%block style%}
<style>
    .customerStyle select {
        background: transparent;
        width: 11vw;
        display: flex;
        justify-content: space-around;
        padding-left: 15%;
        /* border-radius: 10px; */
        border: 0;
        overflow: hidden;
        color: #9FA1A5;
        /* border-radius: 0; */
        height: 57px;
    }

    .customerStyle {
        background: url("{%static 'assets/img/arrow.png'%}") no-repeat right #34383f;
        width: 10vw;
        height: 57px;
        overflow: hidden;
        /* border-radius: 15px; */
        border: 0px;
        overflow: hidden;
        /* box-shadow: -30px 26px 36px -10px rgba(0, 0, 0, 1);
        -webkit-box-shadow: -30px 26px 36px -10px rgba(0, 0, 0, 1);
        -moz-box-shadow: -30px 26px 36px -10px rgba(0, 0, 0, 1); */
    }
</style>
{%endblock style%}


<!-- **************************************************************************************************************
                                    Nav Bar Start
************************************************************************************************************** -->

{%block stats%}{%endblock stats%}                   {%block stats_link%}    inactive    {%endblock stats_link%}

{%block home%}{%endblock home%}               {%block home_link%} inactive  {%endblock home_link%}

{%block events%}active{%endblock events%}                 {%block events_link%}   active    {%endblock events_link%}

{%block config%}{%endblock config%}                 {%block config_link%}   inactive    {%endblock config_link%}

{%block blocklist%}{%endblock blocklist%}           {%block blocklist_link%}    inactive    {%endblock blocklist_link%}

{%block addhawk%}{%endblock addhawk%}               {%block addhawk_link%}  inactive    {%endblock addhawk_link%}

<!-- **************************************************************************************************************
                                        Nav Bar End
************************************************************************************************************** -->


{%block body%}
    <div class="row" style="margin-left: -2%;">
        <div class="col">
            <div id="header" style="background-image: linear-gradient(45deg, #ef422a, #ffffff);background-size: 100%;-webkit-background-clip: text;-moz-background-clip: text;-webkit-text-fill-color: transparent; -moz-text-fill-color: transparent;width: 200.2px;">
            <p
                style="color: rgb(255,255,255);font-family: Poppins, sans-serif;font-size: 35px;text-align: left;font-weight: 700;margin-bottom: 0;width: 900.2px;">
                Events</p>
            </div>
        </div>
    </div>
    {% if eventlist %}
    <div style="margin-top: 27px;">
        <div class="row" style="margin-top: 15px;">
            <div class="col-md-6" style="padding: 0;">
                <div class="d-flex flex-row bd-highlight mb-3">
                    <span style="color: #494d55;font-family: Poppins, sans-serif;margin-top: 1%;">
                        Result found</span>
                    <span style="color: aqua;font-family: Poppins, sans-serif;margin-left: 5px;margin-top: 1%;">
                        {{res}}</span>
                </div>
                <span style="color: #494d55;font-family: Poppins, sans-serif;margin-top: 1%;">
                    Page</span>
                <span style="color: aqua;font-family: Poppins, sans-serif;margin-left: 5px;margin-top: 1%;">
                    {% if page %}{{page}}{%else%}1{%endif%}</span>
                <span style="color: #494d55;font-family: Poppins, sans-serif;margin-top: 1%;">
                    of</span>
                <span style="color: aqua;font-family: Poppins, sans-serif;margin-left: 5px;margin-top: 1%;">
                    {{tot}}</span>
                <input type="checkbox" id="HOST" value="{{hostid}}"
                    style="width: 30px;height: 30px;display: none;" checked>
                <input type="checkbox" id="OPEN" value="{{is_open}}"
                    style="width: 30px;height: 30px;display: none;" checked>
                <input type="checkbox" id="STDATE" value="{{stdate}}"
                    style="width: 30px;height: 30px;display: none;" checked>
                <input type="checkbox" id="STTIME" value="{{sttime}}"
                    style="width: 30px;height: 30px;display: none;" checked>
                <input type="checkbox" id="EDDATE" value="{{eddate}}"
                    style="width: 30px;height: 30px;display: none;" checked>
                <input type="checkbox" id="EDTIME" value="{{edtime}}"
                    style="width: 30px;height: 30px;display: none;" checked>
            </div>
            <div class="col-md-6" style="padding: 0;">
                <div class="row d-flex">
                    <div class="col-lg-8 d-flex flex-row-reverse">
                        <select name="resperpage" id="resperpage" style="display: none;">
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                            <option value="200">200</option>
                        </select>
                    </div>
                    <div class="col-lg-4">
                        <div class="row">
                            <div class="col-lg-2"></div>
                            <div class="col-lg-10" style="justify-content: end;display: flex;">
                                <div class="row">
                                    <div class="col-lg-6" style="padding: 0px;">
                                        &nbsp;
                                    </div>
                                    <div class="col-lg-6" style="padding: 0px;justify-content: end;">
                                        &nbsp;
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-8 d-flex flex-row-reverse">
                        <select name="resperpage" id="resperpage" style="display: none;">
                            <option value="50" selected>50</option>
                            <option value="100">100</option>
                            <option value="200">200</option>
                        </select>
                    </div>
                    <div class="col-lg-4">
                        <div class="row">
                            <div class="col-lg-2"></div>
                            <div class="col-lg-10" style="justify-content: end;display: flex;">
                                <div class="row">
                                    <div class="col-lg-6" style="padding: 0px;">
                                        <form action="/pagdn/" method="GET">
                                            <button type="submit" id="sum1" class="btn"
                                                style="color: cornsilk;"><i
                                                    class="fas fa-chevron-left"></i>&nbsp;Prev</button>
                                        </form>
                                    </div>
                                    <div class="col-lg-6" style="padding: 0px;justify-content: end;">
                                        <form action="/pagup/" method="GET">
                                            <button type="submit" id="sum2" class="btn"
                                                style="color: cornsilk;">Next&nbsp;<i
                                                    class="fas fa-chevron-right"></i></button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row" style="margin-top: 15px;">
        <div class="col-md-12" style="padding: 0;">
            <div class="table-responsive" style="margin-left: 0px;width: 1600px;">
                <table class="table" id="table_id">
                    <thead style="position: sticky;top: 0;background-color: #21242B;">
                        <tr style="color: rgb(255,255,255);text-align: center;">
                            <th style="color: rgb(252, 72, 48);">Id</th>
                            <th style="color: rgb(252, 72, 48);">
                                <div class="dropdown open">
                                    <button class="dropdownBTN dropdown-toggle" type="button" id="hostNameDropdown" data-toggle="dropdown" aria-haspopup="true"
                                            aria-expanded="false">
                                            Nodes
                                            </button>
                                    <div class="dropdown-menu" aria-labelledby="hostNameDropdown" style="width: 400px;padding: 0;border-radius: 25px;background-color: transparent;">
                                        <form action="/events/" method="POST">
                                            {% csrf_token %}
                                            <input type="search" name="hostidentifier" id="hostName" placeholder="Host Name ..?" autocomplete="off" oninput="noteNode_name(this.id,'hostID')">
                                            <div style="display: none;">
                                                <input type="date" id="start_date_1" name="start_date" class="start-date"><input type="time" id="start_time_1" name="start_time" class="start-time">
                                                <input type="date" id="end_date_1" name="end_date" class="start-date"><input type="time" id="end_time_1" name="end_time" class="start-time">
                                            </div>
                                                <select class="selectCustomer" name="isopen" id="isopen_1" style="cursor: pointer;display: none;">
                                                <option value="null" selected>Is Open ?</option>
                                                <option value="1">Open</option>
                                                <option value="0">Close</option>
                                            </select>
                                        </form>
                                    </div>
                                </div>
                            </th>
                            <th style="color: rgb(252, 72, 48);">
                                <div class="dropdown open">
                                    <button class="dropdownBTN dropdown-toggle" type="button" id="hostIdentifierDropdown" data-toggle="dropdown" aria-haspopup="true"
                                            aria-expanded="false">
                                            Nodes-Identifier
                                            </button>
                                    <div class="dropdown-menu" aria-labelledby="hostIdentifierDropdown" style="width: 400px;padding: 0;border-radius: 25px;background-color: transparent;">
                                        <form action="/events/" method="POST">
                                            {% csrf_token %}
                                            <input type="search" name="hostidentifier" id="hostID" placeholder="Host Identifier ..?" autocomplete="off" oninput="noteNode_id(this.id,'hostName')">
                                            <div style="display: none;">
                                                <input type="date" id="start_date_1" name="start_date" class="start-date"><input type="time" id="start_time_1" name="start_time" class="start-time">
                                                <input type="date" id="end_date_1" name="end_date" class="start-date"><input type="time" id="end_time_1" name="end_time" class="start-time">
                                            </div>
                                                <select class="selectCustomer" name="isopen" id="isopen_1" style="cursor: pointer;display: none;">
                                                <option value="null" selected>Is Open ?</option>
                                                <option value="1">Open</option>
                                                <option value="0">Close</option>
                                            </select>
                                        </form>
                                    </div>
                                </div>
                            <th style="color: rgb(252, 72, 48);">
                                <div class="dropdown open">
                                    <button class="dropdownBTN dropdown-toggle" type="button" id="timeDropdown" data-toggle="dropdown" aria-haspopup="true"
                                            aria-expanded="false">
                                            Time
                                            </button>
                                    <div class="dropdown-menu" aria-labelledby="timeDropdown" style="width: 400px;">
                                        <form action="/events/" method="POST">
                                            {% csrf_token %}
                                            <input type="search" name="hostidentifier" id="hostID_2" placeholder="Host name ..?" autocomplete="off" style="display: none;">
                                            <div class="row date-time justify-content-md-center" id="stDate">
                                                    <p style="margin-top: 4%;">Start :&nbsp;&nbsp;&nbsp;</p><input type="date" id="start_date" name="start_date" class="start-date">
                                                    <input type="time" id="start_time" name="start_time" class="start-time">
                                            </div>
                                            <div class="row date-time justify-content-md-center" id="edDate">
                                                <p style="margin-top: 4%;">End :&nbsp;&nbsp;&nbsp;</p><input type="date" id="end_date" name="end_date" class="start-date">
                                                    <input type="time" id="end_time" name="end_time" class="start-time">
                                            </div>
                                            <select class="selectCustomer" name="isopen" id="isopen_2" style="cursor: pointer;display: none;">
                                                <option value="null" selected>Is Open ?</option>
                                                <option value="1">Open</option>
                                                <option value="0">Close</option>
                                            </select>
                                        </form>
                                    </div>
                                </div>
                            </th>
                            <th style="color: rgb(252, 72, 48);">Event Code</th>
                            <th style="color: rgb(252, 72, 48);">Metadata</th>
                            <th style="color: rgb(252, 72, 48);">
                                <div class="dropdown open">
                                    <button class="dropdownBTN dropdown-toggle" type="button" id="isopenDropdown" data-toggle="dropdown" aria-haspopup="true"
                                            aria-expanded="false">
                                            State
                                            </button>
                                    <div class="dropdown-menu" aria-labelledby="isopenDropdown" style="padding: 0;background-color:transparent;">
                                        <form action="/events/" method="POST">
                                            {% csrf_token %}
                                            <input type="search" name="hostidentifier" id="hostID_3" placeholder="Host name ..?" autocomplete="off" style="display: none;">
                                            <div style="display: none;">
                                                <input type="date" id="start_date_3" name="start_date" class="start-date"><input type="time" id="start_time_3" name="start_time" class="start-time">
                                                <input type="date" id="end_date_3" name="end_date" class="start-date"><input type="time" id="end_time_3" name="end_time" class="start-time">
                                            </div>
                                            <div class="customerStyle">
                                                <select class="selectCustomer" name="isopen" id="isopen" style="cursor: pointer" onchange="this.form.submit()">
                                                    <option value="null" selected>Is Open ?</option>
                                                    <option value="1">Open</option>
                                                    <option value="0">Close</option>
                                                </select>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <script>
                        document.getElementById('start_time').value = "00:00";
                        document.getElementById('end_time').value = "00:00";
                    </script>
                    <tbody style="color: rgb(255,255,255);">
                        {%for i in eventlist%}
                        <tr style="text-align: center;">
                            <td>{{forloop.counter}}</td>
                            <td>{{i.hostname}}</td>
                            <td>{{i.host_identifier}}</td>
                            <td>(UTC) {{ i.unixtime | print_timestamp }}</td>
                            <td>{{ i.event_code }}</td>
                            <td>
                                <a class="btn btn-outline-info" data-toggle="collapse" href="#input_{{ i.id }}"
                                    role="button" aria-expanded="false" aria-controls="{{i.id}}raw">
                                    Show more
                                </a>
                                <div class="collapse" id="input_{{ i.id }}">
                                    <div class="card card-body" style="background-color: #21242B;border: 0px;">
                                        {% pretty_json i.metadata %}
                                    </div>
                                </div>
                            </td>
                            <td>
                                {% if i.is_open == "f" %}
                                <form action="/makeopen/" method="GET">
                                    <input type="checkbox" name="event_id" value="{{i.id}}"
                                        style="width: 30px;height: 30px;display: none;" checked>
                                    <button type="submit" class="btn btn-success">Open</button>
                                </form>
                                {%endif%}
                                {% if i.is_open == "t" %}
                                <button type="button" class="btn btn-secondary" data-toggle="modal"
                                    data-target="#blast_{{i.id}}">Close</button>
                                {%endif%}
                                <div class="modal fade" id="blast_{{i.id}}" tabindex="-1" role="dialog"
                                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel"
                                                    style="color: black;">Are you sure you want to Close the
                                                    event</h5>
                                                <button type="button" class="close" data-dismiss="modal"
                                                    aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <form action="/makeclose/" method="GET" autocomplete="off">
                                                <div class="modal-body">
                                                    <div class="form-group">
                                                        <input type="checkbox" name="event_id" value="{{i.id}}"
                                                            style="width: 30px;height: 30px;display: none;"
                                                            checked>
                                                        <label for="commenttxt"
                                                            style="color: black;">Comment</label>
                                                        <input type="text" name="commenttxt"
                                                            class="form-control" id="commenttxt"
                                                            aria-describedby="emailHelp"
                                                            placeholder="Enter Comment">
                                                    </div>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-dismiss="modal">Close</button>
                                                    <button type="submit" class="btn btn-primary">Save
                                                        changes</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        {%endfor%}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    {% elif hostid %}
    <div id="truck">

        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
            y="0px" viewBox="0 0 200 82.7" style="enable-background:new 0 0 200 82.7;" xml:space="preserve">

            <g id="Calque_1">
                <text id="XMLID_3_" transform="matrix(1.2187 0 0 1 13 75.6393)" class="st0 st1">4</text>
                <text id="XMLID_4_" transform="matrix(1.2187 0 0 1 133.0003 73.6393)" class="st0 st1">4</text>
            </g>
            <g id="Calque_2">
                <g>
                    <path id="XMLID_11_" d="M81.8,29.2c4.1-5.7,10.7-9.4,18.3-9.4c6.3,0,12.1,2.7,16.1,6.9c0.6-0.4,1.1-0.7,1.7-1.1
                c-4.4-4.8-10.8-7.9-17.8-7.9c-8.3,0-15.6,4.2-20,10.6C80.7,28.5,81.3,28.8,81.8,29.2z" />
                    <path id="XMLID_2_" d="M118.1,53.7c-4,5.7-10.7,9.5-18.2,9.5c-6.3,0-12.1-2.6-16.2-6.8c-0.6,0.4-1.1,0.7-1.7,1.1
                c4.4,4.8,10.8,7.8,17.9,7.8c8.3,0,15.6-4.3,19.9-10.7C119.2,54.5,118.6,54.1,118.1,53.7z" />
                    <animateTransform attributeName="transform" type="rotate" from="360 100 41.3"
                        to="0 100 41.3" dur="10s" repeatCount="indefinite" />
                </g>
                <g id="XMLID_6_">
                    <g id="XMLID_18_">



                        <circle class="circle" cx="100" cy="41" r="1"></circle>
                    </g>
                </g>
                <defs>
                    <filter id="blurFilter4" x="-20" y="-20" width="200" height="200">
                        <feGaussianBlur in="SourceGraphic" stdDeviation="2" />
                    </filter>
                </defs>
                <path id="XMLID_5_" class="st2" d="M103.8,16.7c0.1,0.3,0.1,0.6,0.1,0.9c11.6,1.9,20.4,11.9,20.4,24.1c0,13.5-10.9,24.4-24.4,24.4
          S75.6,55.1,75.6,41.7c0-3.2,0.6-6.3,1.7-9.1c-0.3-0.2-0.5-0.3-0.7-0.5c-1.2,3-1.9,6.2-1.9,9.6c0,14,11.3,25.3,25.3,25.3
          s25.3-11.3,25.3-25.3C125.3,29,115.9,18.5,103.8,16.7z" />


            </g>
        </svg>

        <div class="message">
            Events not found {{hostid}}
        </div>
    </div>
    {%endif%}
</div>
</div>
{%endblock body%}



{%block script%}
<script>
    let a = document.querySelectorAll("[name=start_time]");
    let b = document.querySelectorAll("[name=end_time]");
    for (let i = 0; i < a.length; i++) {
        a[i].value="00:00";
        b[i].value="00:00";
    }
    if (document.getElementById('STDATE').value) {
        let x = document.querySelectorAll("[name=start_date]");
        let y = document.querySelectorAll("[name=start_time]");
        for (let i = 0; i < x.length; i++) {
            x[i].value=document.getElementById('STDATE').value;
            y[i].value=document.getElementById('STTIME').value;
        }
    }
    if (document.getElementById('EDDATE').value) {
        let x = document.querySelectorAll("[name=end_date]");
        let y = document.querySelectorAll("[name=end_time]");
        for (let i = 0; i < x.length; i++) {
            x[i].value=document.getElementById('EDDATE').value;
            y[i].value=document.getElementById('EDTIME').value;
        }
    }
    let x = document.querySelectorAll("[name=hostidentifier]");
    for (let i = 0; i < x.length; i++) {
        x[i].value=document.getElementById('HOST').value;
    }
    document.getElementById("hostName").value=localStorage.getItem("nodeName");
    document.getElementById("hostID").value=localStorage.getItem("nodeId");
    if (document.getElementById('OPEN').value == "True") {
        let x = document.querySelectorAll("[name=isopen]");
        for (let i = 0; i < x.length; i++) {
            x[i].value=1;
        }
    }
    else if (document.getElementById('OPEN').value == "False") {
        let x = document.querySelectorAll("[name=isopen]");
        for (let i = 0; i < x.length; i++) {
            x[i].value=0;
        }
    }
    else {
        document.getElementById('OPEN').value == null;
    }
    // document.getElementById('start_time').value = "00:00";
    // document.getElementById('end_time').value = "00:00";
    // document.getElementById('start_time_1').value = "00:00";
    // document.getElementById('end_time_1').value = "00:00";
    // document.getElementById('start_time_3').value = "00:00";
    // document.getElementById('end_time_3').value = "00:00";
    // document.getElementById('start_date').value = new Date().toLocaleDateString('ja-JP', { day: '2-digit', month: '2-digit', year: 'numeric' }).replace(/\//gi, '-');
    // document.getElementById('start_time').value = new Date().toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
    // document.getElementById('end_date').value = new Date().toLocaleDateString('ja-JP', { day: '2-digit', month: '2-digit', year: 'numeric' }).replace(/\//gi, '-');
    // document.getElementById('end_time').value = new Date().toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
</script>
<script>
    $(document).ready(function(){
      $('[data-toggle="tooltip"]').tooltip();
    });
</script>
<script>
    function noteNode_name(id1,id2) {
        localStorage.setItem("nodeName", document.getElementById(id1).value);
        localStorage.setItem("nodeId", '');
        document.getElementById(id2).value='';
    }
    function noteNode_id(id1,id2) {
        localStorage.setItem("nodeId", document.getElementById(id1).value);
        localStorage.setItem("nodeName", '');
        document.getElementById(id2).value='';
    }
</script>
{%endblock script%}